<script>
  document.addEventListener('DOMContentLoaded', function() {
    const req = new XMLHttpRequest();
    req.open('GET', 'https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/GDP-data.json', true);
    req.send();
    req.onload = function() {
      const json = JSON.parse(req.responseText);
      const xValues = json.data.map((d) => new Date(d[0]));
      const yValues = json.data.map((d) => d[1]);
      createBarChart(xValues, yValues);
    };
  });

  const createBarChart = (xValues, yValues) => {
    const chartWidth = 800;
    const chartHeight = 500;

    const svgPadding = 60;
    const svgWidth = chartWidth + (svgPadding * 2);
    const svgHeight = chartHeight + (svgPadding * 2);
    
    const xPadding = 1;

    // dynamic width for regularly spaced x values
    let xWidth = chartWidth / xValues.length - xPadding;

    if (xWidth <= 0) {
      xWidth = 1;
    }

    const svg = d3.select('body')
                  .append('svg')
                  .attr('width', svgWidth)
                  .attr('height', svgHeight);

    const xScale = d3.scaleTime()
                     .domain([d3.min(xValues), d3.max(xValues)])
                     .range([0, chartWidth]);

    const yScale = d3.scaleLinear()
                     .domain([0, d3.max(yValues)])
                     .range([chartHeight, 0]);

    svg.selectAll('rect')
       .data(xValues)
       .enter()
       .append('rect')
       .attr('class', 'bar')
       .attr('width', xWidth)
       .attr('x', (x) => xScale(x));

    svg.selectAll('rect')
       .data(yValues)
       .attr('height', (yVal) => chartHeight - yScale(yVal))
       .attr('y', (yVal) => yScale(yVal));

    const xAxis = d3.axisBottom(xScale);
    svg.append('g')
       .attr('id', 'x-axis')
       .attr('transform', 'translate(0, ' + chartHeight + ')')
       .call(xAxis);
  };

</script>

<body>
  <title id='title'></title>

  <script src='https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js'></script>
  <script src='https://d3js.org/d3.v5.min.js'></script>
</body>

